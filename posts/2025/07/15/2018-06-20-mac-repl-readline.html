<div class="wide-logos">
  <p><img src="/posts/assets/python.png" alt="python" /></p>
</div>

<div id="intro">
  <p>How to use readline in the Python interactive interpreter on Mac.</p>
</div>

<p>Install the gnureadline Python package:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>gnureadline
</code></pre></div></div>

<p>Create a <code class="language-plaintext highlighter-rouge">~/.pythonstartup.py</code> script:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">atexit</span>
<span class="kn">import</span> <span class="nn">gnureadline</span> <span class="k">as</span> <span class="n">readline</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="p">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">StreamHandler</span><span class="p">())</span>
<span class="n">logger</span><span class="p">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="c1"># Enable Tab Completion. OSX's bind should only be applied with legacy readline.
</span><span class="n">readline</span><span class="p">.</span><span class="n">parse_and_bind</span><span class="p">(</span>
    <span class="s">"bind ^I rl_complete"</span>
    <span class="k">if</span> <span class="n">sys</span><span class="p">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">"darwin"</span> <span class="ow">and</span> <span class="s">"libedit"</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">.</span><span class="n">__doc__</span>
    <span class="k">else</span> <span class="s">"tab: complete"</span>
<span class="p">)</span>

<span class="c1"># Enable History File
</span><span class="n">history_file</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s">"PYTHON_HISTORY_FILE"</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">environ</span><span class="p">[</span><span class="s">"HOME"</span><span class="p">],</span> <span class="s">".pythonhistory"</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">history_file</span><span class="p">):</span>
    <span class="n">readline</span><span class="p">.</span><span class="n">read_history_file</span><span class="p">(</span><span class="n">history_file</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">history_file</span><span class="p">,</span> <span class="s">"a"</span><span class="p">).</span><span class="n">close</span><span class="p">()</span>
<span class="n">atexit</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">readline</span><span class="p">.</span><span class="n">write_history_file</span><span class="p">,</span> <span class="n">history_file</span><span class="p">)</span>

<span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Booted ~/.pythonstartup.py."</span><span class="p">)</span>
</code></pre></div></div>

<p>Set the <code class="language-plaintext highlighter-rouge">PYTHONSTARTUP</code> env var:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PYTHONSTARTUP</span><span class="o">=</span><span class="nv">$HOME</span>/.pythonstartup.py
</code></pre></div></div>

<p>Start the Python REPL.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python
Python 3.6.5 <span class="o">(</span>default, Mar 29 2018, 15:37:32<span class="o">)</span>
<span class="o">[</span>GCC 4.2.1 Compatible Apple LLVM 9.0.0 <span class="o">(</span>clang-900.0.39.2<span class="o">)]</span> on darwin
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
Booted pythonstartup.py.
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>
