<div class="wide-logos">
  <p><img src="/posts/assets/airflow.png" alt="airflow" /></p>
</div>

<p>Airflow has a fairly strange way of registering DAGs and tasks. They’re put
into the global namespace of the DAG definition file.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dag</span> <span class="o">=</span> <span class="n">DAG</span><span class="p">(</span><span class="n">dag_id</span><span class="o">=</span><span class="s">'foo'</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">)</span>
<span class="n">MyOperator</span><span class="p">(</span><span class="n">dag</span><span class="o">=</span><span class="n">dag</span><span class="p">,</span> <span class="n">task_id</span><span class="o">=</span><span class="s">'foo'</span><span class="p">)</span>
</code></pre></div></div>

<p>Airflow then comes along and finds them.</p>

<p>When importing that file however, as you do when unit testing, it’s not ideal
to have those global objects created.</p>

<p>The solution is to protect that code with an <code class="language-plaintext highlighter-rouge">if</code> statement:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">__name__</span><span class="p">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'unusual_prefix'</span><span class="p">):</span>
    <span class="n">dag</span> <span class="o">=</span> <span class="n">DAG</span><span class="p">(</span><span class="n">dag_id</span><span class="o">=</span><span class="s">'foo'</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">)</span>
    <span class="n">MyOperator</span><span class="p">(</span><span class="n">dag</span><span class="o">=</span><span class="n">dag</span><span class="p">,</span> <span class="n">task_id</span><span class="o">=</span><span class="s">'foo'</span><span class="p">)</span>
</code></pre></div></div>

<p>This is Airflow’s equivalent of <a href="http://effbot.org/pyfaq/tutor-what-is-if-name-main-for.htm"><code class="language-plaintext highlighter-rouge">if __name__ == "__main__"</code></a>.</p>

<p>Airflow will still find your DAG as normal, however that code inside the block
won’t be executed when the module is imported.</p>
